<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
<link href="coqdoc.css" rel="stylesheet" type="text/css"/>
<title>CoRN.reals.fast.CRGeometricSum</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<div class="code">

<br/>

<br/>

<br/>

<br/>

<br/>
</div>

<div class="doc">
<a name="lab678"></a><h2 class="section">Geometric Series</h2>

A geometric series is simple to sum.  However we do something slightly
more general.  We sum a series that satifies the ratio test. 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Section</span> <span class="id" type="section"><a name="GeometricSeries">GeometricSeries</a></span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="variable"><a name="GeometricSeries.a">a</a></span> : <span class="id" type="record"><a class="idref" href="http://coq.inria.fr/library/Coq.QArith.QArith_base.html#Q">Q</a></span>.<br/>

<br/>
<span class="id" type="keyword">Hypothesis</span> <span class="id" type="variable"><a name="GeometricSeries.Ha0">Ha0</a></span> : 0 &lt;= <span class="id" type="var">a</span>.<br/>
<span class="id" type="keyword">Hypothesis</span> <span class="id" type="variable"><a name="GeometricSeries.Ha1">Ha1</a></span> : <span class="id" type="var">a</span> &lt; 1.<br/>

<br/>
</div>

<div class="doc">
The definition of what we are calling a <span class="inlinecode"><span class="id" type="var">GeometricSeries</span></span>: a series
that satifies the ratio test. 
</div>
<div class="code">
<span class="id" type="keyword">Definition</span> <span class="id" type="definition"><a name="GeometricSeries">GeometricSeries</a></span> := <span class="id" type="inductive"><a class="idref" href="http://coq.inria.fr/library/Coq.Lists.Streams.html#ForAll">ForAll</a></span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">s</span> =&gt; <span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.QArith.Qabs.html#Qabs">Qabs</a></span> ((<span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.Lists.Streams.html#hd">hd</a></span> (<span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.Lists.Streams.html#tl">tl</a></span> <span class="id" type="var">s</span>))) &lt;= <span class="id" type="var">a</span>*(Qabs(hd <span class="id" type="var">s</span>))).<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" type="var">err_bound</span></span> is a bound on how the series could be in terms of its
head elemement. 
</div>
<div class="code">
<span class="id" type="keyword">Let</span> <span class="id" type="definition"><a name="err_bound">err_bound</a></span> (<span class="id" type="var">s</span>:Stream <span class="id" type="record"><a class="idref" href="http://coq.inria.fr/library/Coq.QArith.QArith_base.html#Q">Q</a></span>) : <span class="id" type="record"><a class="idref" href="http://coq.inria.fr/library/Coq.QArith.QArith_base.html#Q">Q</a></span> := <span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.QArith.Qabs.html#Qabs">Qabs</a></span> (<span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.Lists.Streams.html#hd">hd</a></span> <span class="id" type="var">s</span>)/(1-a).<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" type="var">err_prop</span></span>: is err an bound on the series s? 
</div>
<div class="code">
<span class="id" type="keyword">Let</span> <span class="id" type="definition"><a name="err_prop">err_prop</a></span> (<span class="id" type="var">err</span>:Q) (<span class="id" type="var">s</span>:Stream <span class="id" type="record"><a class="idref" href="http://coq.inria.fr/library/Coq.QArith.QArith_base.html#Q">Q</a></span>) : <span class="id" type="inductive"><a class="idref" href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> := <br/>
<span class="id" type="keyword">match</span> ((<span class="id" type="var">err_bound</span> <span class="id" type="var">s</span>) ?= <span class="id" type="var">err</span>) <span class="id" type="keyword">with</span><br/>
&nbsp;<span class="id" type="constructor"><a class="idref" href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Gt">Gt</a></span> =&gt; <span class="id" type="constructor"><a class="idref" href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
|_ =&gt; <span class="id" type="constructor"><a class="idref" href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span><br/>
<span class="id" type="keyword">end</span>.<br/>

<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="lemma"><a name="err_prop_prop">err_prop_prop</a></span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">e</span> <span class="id" type="var">s</span>, <span class="id" type="var">err_prop</span> <span class="id" type="var">e</span> <span class="id" type="var">s</span> &lt;-&gt; <span class="id" type="var">err_bound</span> <span class="id" type="var">s</span> &lt;= <span class="id" type="var">e</span>.<br/>

<br/>
</div>

<div class="doc">
The key lemma bout error bounds. 
</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <span class="id" type="lemma"><a name="err_prop_key">err_prop_key</a></span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">e</span>:Q) (<span class="id" type="var">s</span>: <span class="id" type="inductive"><a class="idref" href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id" type="record"><a class="idref" href="http://coq.inria.fr/library/Coq.QArith.QArith_base.html#Q">Q</a></span>) (<span class="id" type="var">x</span>:Q), <br/>
&nbsp;<span class="id" type="var">err_prop</span> <span class="id" type="var">e</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.QArith.Qabs.html#Qabs">Qabs</a></span> <span class="id" type="var">x</span> &lt;= <span class="id" type="var">a</span>*e -&gt; <span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.QArith.Qabs.html#Qabs">Qabs</a></span> (<span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.QArith.Qreduction.html#Qplus'">Qplus'</a></span> (<span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.Lists.Streams.html#hd">hd</a></span> <span class="id" type="var">s</span>) <span class="id" type="var">x</span>) &lt;= <span class="id" type="var">e</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="lemma"><a name="err_prop_key'">err_prop_key'</a></span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">e</span>:Q) (<span class="id" type="var">s</span>: <span class="id" type="inductive"><a class="idref" href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id" type="record"><a class="idref" href="http://coq.inria.fr/library/Coq.QArith.QArith_base.html#Q">Q</a></span>), <br/>
&nbsp;<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.CRGeometricSum.html#GeometricSeries">GeometricSeries</a></span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">err_prop</span> <span class="id" type="var">e</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">err_prop</span> (<span class="id" type="var">a</span>*e) (<span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.Lists.Streams.html#tl">tl</a></span> <span class="id" type="var">s</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="lemma"><a name="err_prop_monotone">err_prop_monotone</a></span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">e0</span> <span class="id" type="var">e1</span>:Q) (<span class="id" type="var">s</span>: <span class="id" type="inductive"><a class="idref" href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id" type="record"><a class="idref" href="http://coq.inria.fr/library/Coq.QArith.QArith_base.html#Q">Q</a></span>), (<span class="id" type="var">e0</span> &lt;= <span class="id" type="var">e1</span>) -&gt; <span class="id" type="var">err_prop</span> <span class="id" type="var">e0</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">err_prop</span> <span class="id" type="var">e1</span> <span class="id" type="var">s</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="lemma"><a name="err_prop_monotone'">err_prop_monotone'</a></span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">e</span>:Q) (<span class="id" type="var">s</span>: <span class="id" type="inductive"><a class="idref" href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id" type="record"><a class="idref" href="http://coq.inria.fr/library/Coq.QArith.QArith_base.html#Q">Q</a></span>), <span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.CRGeometricSum.html#GeometricSeries">GeometricSeries</a></span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">err_prop</span> <span class="id" type="var">e</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">err_prop</span> <span class="id" type="var">e</span> (<span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.Lists.Streams.html#tl">tl</a></span> <span class="id" type="var">s</span>).<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" type="var">InfiniteSum</span></span> is sums the series s.

<br/><br/>
<span class="inlinecode"><span class="id" type="var">InfiniteSum_raw_F</span></span> is the body of the fixpoint.  It tests the error of
the partial sum and bails out early if the error becomes small enough.

</div>
<div class="code">
<span class="id" type="keyword">Definition</span> <span class="id" type="definition"><a name="InfiniteSum_raw_F">InfiniteSum_raw_F</a></span> <span class="id" type="var">rec</span> (<span class="id" type="var">err_prop</span>:Stream <span class="id" type="record"><a class="idref" href="http://coq.inria.fr/library/Coq.QArith.QArith_base.html#Q">Q</a></span> -&gt; <span class="id" type="inductive"><a class="idref" href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>) (<span class="id" type="var">s</span>:Stream <span class="id" type="record"><a class="idref" href="http://coq.inria.fr/library/Coq.QArith.QArith_base.html#Q">Q</a></span>) : <span class="id" type="record"><a class="idref" href="http://coq.inria.fr/library/Coq.QArith.QArith_base.html#Q">Q</a></span> :=<br/>
<span class="id" type="keyword">if</span> (<span class="id" type="var">err_prop</span> <span class="id" type="var">s</span>) <span class="id" type="keyword">then</span> 0 <span class="id" type="keyword">else</span> (<span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.QArith.Qreduction.html#Qplus'">Qplus'</a></span> (<span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.Lists.Streams.html#hd">hd</a></span> <span class="id" type="var">s</span>) (<span class="id" type="var">rec</span> <span class="id" type="var">err_prop</span> (<span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.Lists.Streams.html#tl">tl</a></span> <span class="id" type="var">s</span>))).<br/>

<br/>
</div>

<div class="doc">
By carefully using continuations, we can efficently compute n
iterations of <span class="inlinecode"><span class="id" type="var">InfiniteSum_raw_F</span></span> with call-by-value. 
</div>
<div class="code">
<span class="id" type="keyword">Fixpoint</span> <span class="id" type="definition"><a name="InfiniteSum_raw_N">InfiniteSum_raw_N</a></span> (<span class="id" type="var">n</span>:positive) (<span class="id" type="var">cont</span>: (<span class="id" type="inductive"><a class="idref" href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id" type="record"><a class="idref" href="http://coq.inria.fr/library/Coq.QArith.QArith_base.html#Q">Q</a></span> -&gt; <span class="id" type="inductive"><a class="idref" href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>) -&gt; <span class="id" type="inductive"><a class="idref" href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id" type="record"><a class="idref" href="http://coq.inria.fr/library/Coq.QArith.QArith_base.html#Q">Q</a></span> -&gt; <span class="id" type="record"><a class="idref" href="http://coq.inria.fr/library/Coq.QArith.QArith_base.html#Q">Q</a></span>) {<span class="id" type="keyword">struct</span> <span class="id" type="var">n</span>} : (<span class="id" type="inductive"><a class="idref" href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id" type="record"><a class="idref" href="http://coq.inria.fr/library/Coq.QArith.QArith_base.html#Q">Q</a></span> -&gt; <span class="id" type="inductive"><a class="idref" href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>) -&gt; <span class="id" type="inductive"><a class="idref" href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id" type="record"><a class="idref" href="http://coq.inria.fr/library/Coq.QArith.QArith_base.html#Q">Q</a></span> -&gt; <span class="id" type="record"><a class="idref" href="http://coq.inria.fr/library/Coq.QArith.QArith_base.html#Q">Q</a></span> :=<br/>
<span class="id" type="keyword">match</span> <span class="id" type="var">n</span> <span class="id" type="keyword">with</span><br/>
| <span class="id" type="constructor"><a class="idref" href="http://coq.inria.fr/library/Coq.NArith.BinPos.html#xH">xH</a></span> =&gt; <span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.CRGeometricSum.html#InfiniteSum_raw_F">InfiniteSum_raw_F</a></span> <span class="id" type="var">cont</span><br/>
| <span class="id" type="constructor"><a class="idref" href="http://coq.inria.fr/library/Coq.NArith.BinPos.html#xO">xO</a></span> <span class="id" type="var">n'</span> =&gt; <span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.CRGeometricSum.html#InfiniteSum_raw_N">InfiniteSum_raw_N</a></span> <span class="id" type="var">n'</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">err</span> <span class="id" type="var">s</span> =&gt; <span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.CRGeometricSum.html#InfiniteSum_raw_N">InfiniteSum_raw_N</a></span> <span class="id" type="var">n'</span> <span class="id" type="var">cont</span> <span class="id" type="var">err</span> <span class="id" type="var">s</span>)<br/>
| <span class="id" type="constructor"><a class="idref" href="http://coq.inria.fr/library/Coq.NArith.BinPos.html#xI">xI</a></span> <span class="id" type="var">n'</span> =&gt; <span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.CRGeometricSum.html#InfiniteSum_raw_F">InfiniteSum_raw_F</a></span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">err</span> <span class="id" type="var">s</span> =&gt;<br/>
&nbsp;(<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.CRGeometricSum.html#InfiniteSum_raw_N">InfiniteSum_raw_N</a></span> <span class="id" type="var">n'</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">err</span> <span class="id" type="var">s</span> =&gt; <span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.CRGeometricSum.html#InfiniteSum_raw_N">InfiniteSum_raw_N</a></span> <span class="id" type="var">n'</span> <span class="id" type="var">cont</span> <span class="id" type="var">err</span> <span class="id" type="var">s</span>)) <span class="id" type="var">err</span> <span class="id" type="var">s</span>)<br/>
<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Lemmas for reasoning about InfiniteSum_raw_N. 
</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <span class="id" type="lemma"><a name="InfiniteSum_raw_N_F">InfiniteSum_raw_N_F</a></span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">p</span> <span class="id" type="var">c</span>,<br/>
&nbsp;<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.CRGeometricSum.html#InfiniteSum_raw_N">InfiniteSum_raw_N</a></span> <span class="id" type="var">p</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">err</span> <span class="id" type="var">s</span> =&gt; <span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.CRGeometricSum.html#InfiniteSum_raw_F">InfiniteSum_raw_F</a></span> <span class="id" type="var">c</span> <span class="id" type="var">err</span> <span class="id" type="var">s</span>)= <br/>
&nbsp;<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.CRGeometricSum.html#InfiniteSum_raw_F">InfiniteSum_raw_F</a></span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">err</span> <span class="id" type="var">s</span> =&gt; <span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.CRGeometricSum.html#InfiniteSum_raw_N">InfiniteSum_raw_N</a></span> <span class="id" type="var">p</span> <span class="id" type="var">c</span> <span class="id" type="var">err</span> <span class="id" type="var">s</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="lemma"><a name="InfiniteSum_raw_N_Psucc">InfiniteSum_raw_N_Psucc</a></span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">p</span> <span class="id" type="var">c</span>,<br/>
&nbsp;<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.CRGeometricSum.html#InfiniteSum_raw_N">InfiniteSum_raw_N</a></span> (<span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.NArith.BinPos.html#Psucc">Psucc</a></span> <span class="id" type="var">p</span>) <span class="id" type="var">c</span> = <br/>
&nbsp;<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.CRGeometricSum.html#InfiniteSum_raw_F">InfiniteSum_raw_F</a></span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">err</span> <span class="id" type="var">s</span> =&gt; <span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.CRGeometricSum.html#InfiniteSum_raw_N">InfiniteSum_raw_N</a></span> <span class="id" type="var">p</span> <span class="id" type="var">c</span> <span class="id" type="var">err</span> <span class="id" type="var">s</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="lemma"><a name="InfiniteSum_raw_N_extend'">InfiniteSum_raw_N_extend'</a></span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">p</span> <span class="id" type="var">q</span>:positive) <span class="id" type="var">s</span> (<span class="id" type="var">err</span> : <span class="id" type="inductive"><a class="idref" href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id" type="record"><a class="idref" href="http://coq.inria.fr/library/Coq.QArith.QArith_base.html#Q">Q</a></span> -&gt; <span class="id" type="inductive"><a class="idref" href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>),<br/>
&nbsp;(<span class="id" type="var">err</span> (<span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Str_nth_tl">Str_nth_tl</a></span> (<span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.NArith.BinPos.html#nat_of_P">nat_of_P</a></span> <span class="id" type="var">p</span>) <span class="id" type="var">s</span>)) -&gt; (<span class="id" type="var">p</span> &lt;= <span class="id" type="var">q</span>)%Z -&gt;<br/>
&nbsp;<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.CRGeometricSum.html#InfiniteSum_raw_N">InfiniteSum_raw_N</a></span> <span class="id" type="var">p</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> =&gt; 0) <span class="id" type="var">err</span> <span class="id" type="var">s</span> = <span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.CRGeometricSum.html#InfiniteSum_raw_N">InfiniteSum_raw_N</a></span> <span class="id" type="var">q</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> =&gt; 0) <span class="id" type="var">err</span> <span class="id" type="var">s</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="lemma"><a name="InfiniteSum_raw_N_extend">InfiniteSum_raw_N_extend</a></span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">p</span>:positive) <span class="id" type="var">s</span> (<span class="id" type="var">err</span> : <span class="id" type="inductive"><a class="idref" href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Stream">Stream</a></span> <span class="id" type="record"><a class="idref" href="http://coq.inria.fr/library/Coq.QArith.QArith_base.html#Q">Q</a></span> -&gt; <span class="id" type="inductive"><a class="idref" href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>),<br/>
&nbsp;(<span class="id" type="var">err</span> (<span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Str_nth_tl">Str_nth_tl</a></span> (<span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.NArith.BinPos.html#nat_of_P">nat_of_P</a></span> <span class="id" type="var">p</span>) <span class="id" type="var">s</span>)) -&gt;<br/>
&nbsp;<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.CRGeometricSum.html#InfiniteSum_raw_N">InfiniteSum_raw_N</a></span> <span class="id" type="var">p</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> =&gt; 0) <span class="id" type="var">err</span> <span class="id" type="var">s</span> = <span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.CRGeometricSum.html#InfiniteSum_raw_N">InfiniteSum_raw_N</a></span> (<span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.NArith.BinPos.html#Psucc">Psucc</a></span> <span class="id" type="var">p</span>) (<span class="id" type="keyword">fun</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> =&gt; 0) <span class="id" type="var">err</span> <span class="id" type="var">s</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="lemma"><a name="InfiniteSum_raw_N_ind">InfiniteSum_raw_N_ind</a></span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">err</span>:Stream <span class="id" type="record"><a class="idref" href="http://coq.inria.fr/library/Coq.QArith.QArith_base.html#Q">Q</a></span> -&gt; <span class="id" type="inductive"><a class="idref" href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>) (<span class="id" type="var">P</span>:Stream <span class="id" type="record"><a class="idref" href="http://coq.inria.fr/library/Coq.QArith.QArith_base.html#Q">Q</a></span> -&gt; <span class="id" type="record"><a class="idref" href="http://coq.inria.fr/library/Coq.QArith.QArith_base.html#Q">Q</a></span> -&gt; <span class="id" type="keyword">Prop</span>),<br/>
&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, (<span class="id" type="var">err</span> <span class="id" type="var">s</span>) -&gt; <span class="id" type="var">P</span> <span class="id" type="var">s</span> 0) -&gt;<br/>
&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">rec</span>, ~(err <span class="id" type="var">s</span>) -&gt; <span class="id" type="var">P</span> (<span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.Lists.Streams.html#tl">tl</a></span> <span class="id" type="var">s</span>) <span class="id" type="var">rec</span> -&gt; <span class="id" type="var">P</span> <span class="id" type="var">s</span> (<span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.QArith.Qreduction.html#Qplus'">Qplus'</a></span> (<span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.Lists.Streams.html#hd">hd</a></span> <span class="id" type="var">s</span>) <span class="id" type="var">rec</span>)) -&gt;<br/>
&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">p</span>:positive) <span class="id" type="var">s</span>, (<span class="id" type="var">err</span> (<span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Str_nth_tl">Str_nth_tl</a></span> (<span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.NArith.BinPos.html#nat_of_P">nat_of_P</a></span> <span class="id" type="var">p</span>) <span class="id" type="var">s</span>)) -&gt; <span class="id" type="var">P</span> <span class="id" type="var">s</span> (<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.CRGeometricSum.html#InfiniteSum_raw_N">InfiniteSum_raw_N</a></span> <span class="id" type="var">p</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">err</span> <span class="id" type="var">s</span> =&gt; 0) <span class="id" type="var">err</span> <span class="id" type="var">s</span>).<br/>

<br/>
</div>

<div class="doc">
The infinite sum is indeed bounded by an error bound. 
</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <span class="id" type="lemma"><a name="err_prop_correct">err_prop_correct</a></span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">e</span>:Qpos) <span class="id" type="var">s</span>, (<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.CRGeometricSum.html#GeometricSeries">GeometricSeries</a></span> <span class="id" type="var">s</span>) -&gt; (<span class="id" type="var">err_prop</span> <span class="id" type="var">e</span> <span class="id" type="var">s</span>) -&gt;<br/>
&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">p</span>:positive) (<span class="id" type="var">e'</span>:Stream <span class="id" type="record"><a class="idref" href="http://coq.inria.fr/library/Coq.QArith.QArith_base.html#Q">Q</a></span> -&gt; <span class="id" type="inductive"><a class="idref" href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>),<br/>
&nbsp;&nbsp;(<span class="id" type="var">e'</span> (<span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Str_nth_tl">Str_nth_tl</a></span> (<span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.NArith.BinPos.html#nat_of_P">nat_of_P</a></span> <span class="id" type="var">p</span>) <span class="id" type="var">s</span>)) -&gt; <span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.QArith.Qabs.html#Qabs">Qabs</a></span> (<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.CRGeometricSum.html#InfiniteSum_raw_N">InfiniteSum_raw_N</a></span> <span class="id" type="var">p</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">err</span> <span class="id" type="var">s</span> =&gt; 0) <span class="id" type="var">e'</span> <span class="id" type="var">s</span>) &lt;= <span class="id" type="var">e</span>.<br/>

<br/>
</div>

<div class="doc">
This lemma tells us how to compute an upper bound on the number of
terms we will need to compute.  It is okay for this error to be loose
because the partial sums will bail out early when it sees that its
estimate of the error is small enough. 
</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <span class="id" type="lemma"><a name="GeometricCovergenceLemma">GeometricCovergenceLemma</a></span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">n</span>:positive) (<span class="id" type="var">e</span>:Qpos),<br/>
&nbsp;/(e*(1 - <span class="id" type="var">a</span>)) &lt;= <span class="id" type="var">n</span> -&gt; <span class="id" type="var">a</span>^n &lt;= <span class="id" type="var">e</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="definition"><a name="InfiniteGeometricSum_maxIter">InfiniteGeometricSum_maxIter</a></span> <span class="id" type="var">series</span> (<span class="id" type="var">err</span>:Qpos) : <span class="id" type="inductive"><a class="idref" href="http://coq.inria.fr/library/Coq.NArith.BinPos.html#positive">positive</a></span> :=<br/>
<span class="id" type="keyword">let</span> <span class="id" type="var">x</span> := (1-a) <span class="id" type="keyword">in</span><br/>
<span class="id" type="keyword">let</span> (<span class="id" type="var">n</span>,d) := (<span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.QArith.Qabs.html#Qabs">Qabs</a></span> (<span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.Lists.Streams.html#hd">hd</a></span> <span class="id" type="var">series</span>))/(err*x*x) <span class="id" type="keyword">in</span> <br/>
<span class="id" type="keyword">match</span> <span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Zsucc">Zsucc</a></span> (<span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.ZArith.Zdiv.html#Zdiv">Zdiv</a></span> <span class="id" type="var">n</span> <span class="id" type="var">d</span>) <span class="id" type="keyword">with</span><br/>
| <span class="id" type="constructor"><a class="idref" href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Zpos">Zpos</a></span> <span class="id" type="var">p</span> =&gt; <span class="id" type="var">p</span><br/>
| <span class="id" type="var">_</span> =&gt; 1%positive<br/>
<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="lemma"><a name="InfiniteGeometricSum_maxIter_monotone">InfiniteGeometricSum_maxIter_monotone</a></span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">series</span> (<span class="id" type="var">err</span>:Qpos),<br/>
&nbsp;<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.CRGeometricSum.html#GeometricSeries">GeometricSeries</a></span> <span class="id" type="var">series</span> -&gt;<br/>
&nbsp;(<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.CRGeometricSum.html#InfiniteGeometricSum_maxIter">InfiniteGeometricSum_maxIter</a></span> (<span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.Lists.Streams.html#tl">tl</a></span> <span class="id" type="var">series</span>) <span class="id" type="var">err</span> &lt;= <span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.CRGeometricSum.html#InfiniteGeometricSum_maxIter">InfiniteGeometricSum_maxIter</a></span> <span class="id" type="var">series</span> <span class="id" type="var">err</span>)%Z.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="lemma"><a name="InfiniteGeometricSum_maxIter_correct">InfiniteGeometricSum_maxIter_correct</a></span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">series</span> (<span class="id" type="var">err</span>:Qpos), <span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.CRGeometricSum.html#GeometricSeries">GeometricSeries</a></span> <span class="id" type="var">series</span> -&gt;<br/>
&nbsp;<span class="id" type="var">err_prop</span> <span class="id" type="var">err</span> (<span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Str_nth_tl">Str_nth_tl</a></span> (<span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.NArith.BinPos.html#nat_of_P">nat_of_P</a></span> (<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.CRGeometricSum.html#InfiniteGeometricSum_maxIter">InfiniteGeometricSum_maxIter</a></span> <span class="id" type="var">series</span> <span class="id" type="var">err</span>)) <span class="id" type="var">series</span>).<br/>

<br/>
</div>

<div class="doc">
The implemenation of <span class="inlinecode"><span class="id" type="var">InfiniteGeometricSum</span></span>. 
</div>
<div class="code">
<span class="id" type="keyword">Definition</span> <span class="id" type="definition"><a name="InfiniteGeometricSum_raw">InfiniteGeometricSum_raw</a></span> <span class="id" type="var">series</span> (<span class="id" type="var">e</span>:QposInf) : <span class="id" type="record"><a class="idref" href="http://coq.inria.fr/library/Coq.QArith.QArith_base.html#Q">Q</a></span> :=<br/>
<span class="id" type="keyword">match</span> <span class="id" type="var">e</span> <span class="id" type="keyword">with</span><br/>
| &infin; =&gt; 0<br/>
| <span class="id" type="constructor"><a class="idref" href="CoRN.model.structures.QposInf.html#Qpos2QposInf">Qpos2QposInf</a></span> <span class="id" type="var">err</span> =&gt; <span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.CRGeometricSum.html#InfiniteSum_raw_N">InfiniteSum_raw_N</a></span> (<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.CRGeometricSum.html#InfiniteGeometricSum_maxIter">InfiniteGeometricSum_maxIter</a></span> <span class="id" type="var">series</span> <span class="id" type="var">err</span>)<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">err</span> <span class="id" type="var">s</span> =&gt; 0) (<span class="id" type="var">err_prop</span> <span class="id" type="var">err</span>) <span class="id" type="var">series</span><br/>
<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="lemma"><a name="InfiniteGeometricSum_raw_prf">InfiniteGeometricSum_raw_prf</a></span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">series</span>, <span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.CRGeometricSum.html#GeometricSeries">GeometricSeries</a></span> <span class="id" type="var">series</span> -&gt;<br/>
<span class="id" type="var">is_RegularFunction</span> (<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.CRGeometricSum.html#InfiniteGeometricSum_raw">InfiniteGeometricSum_raw</a></span> <span class="id" type="var">series</span>).<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="definition"><a name="InfiniteGeometricSum">InfiniteGeometricSum</a></span> <span class="id" type="var">series</span> (<span class="id" type="var">Gs</span>:GeometricSeries <span class="id" type="var">series</span>) : <span class="id" type="definition"><a class="idref" href="CoRN.model.metric2.CRmetric.html#CR">CR</a></span> :=<br/>
<span class="id" type="var">Build_RegularFunction</span> (<span class="id" type="lemma"><a class="idref" href="CoRN.reals.fast.CRGeometricSum.html#InfiniteGeometricSum_raw_prf">InfiniteGeometricSum_raw_prf</a></span> <span class="id" type="var">Gs</span>).<br/>

<br/>
</div>

<div class="doc">
The <span class="inlinecode"><span class="id" type="var">InfiniteGeometricSum</span></span> is correct. 
</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <span class="id" type="lemma"><a name="InfiniteGeometricSum_step">InfiniteGeometricSum_step</a></span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">series</span> (<span class="id" type="var">Gs</span>:GeometricSeries <span class="id" type="var">series</span>),<br/>
&nbsp;(<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.CRGeometricSum.html#InfiniteGeometricSum">InfiniteGeometricSum</a></span> <span class="id" type="var">Gs</span> ==<br/>
&nbsp;&nbsp;('(<span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.Lists.Streams.html#hd">hd</a></span> <span class="id" type="var">series</span>))+(InfiniteGeometricSum (<span class="id" type="lemma"><a class="idref" href="http://coq.inria.fr/library/Coq.Lists.Streams.html#ForAll_Str_nth_tl">ForAll_Str_nth_tl</a></span> 1%nat <span class="id" type="var">Gs</span>)))%CR.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="lemma"><a name="InfiniteGeometricSum_bound">InfiniteGeometricSum_bound</a></span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">series</span><br/>
&nbsp;(<span class="id" type="var">Gs</span>:GeometricSeries <span class="id" type="var">series</span>),<br/>
&nbsp;<span class="id" type="definition"><a class="idref" href="CoRN.algebra.COrdAbs.html#AbsSmall">AbsSmall</a></span> (<span class="id" type="var">R</span>:=CRasCOrdField) ('(<span class="id" type="var">err_bound</span> <span class="id" type="var">series</span>))%CR (<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.CRGeometricSum.html#InfiniteGeometricSum">InfiniteGeometricSum</a></span> <span class="id" type="var">Gs</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="lemma"><a name="InfiniteGeometricSum_small_tail">InfiniteGeometricSum_small_tail</a></span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">series</span> (<span class="id" type="var">e</span> : Q<SUP>+</SUP>),<br/>
<span class="id" type="var">GeometricSeries</span> <span class="id" type="var">series</span> -&gt;<br/>
{<span class="id" type="var">n</span> : <b>N</b> &amp; <span class="id" type="keyword">forall</span> <span class="id" type="var">Gs</span> : <span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.CRGeometricSum.html#GeometricSeries">GeometricSeries</a></span> (<span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Str_nth_tl">Str_nth_tl</a></span> <span class="id" type="var">n</span> <span class="id" type="var">series</span>),<br/>
<span class="id" type="var">AbsSmall</span> (<span class="id" type="var">R</span>:=CRasCOrdField) (' <span class="id" type="var">e</span>)%CR (<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.CRGeometricSum.html#InfiniteGeometricSum">InfiniteGeometricSum</a></span> <span class="id" type="var">Gs</span>)}.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="lemma"><a name="GeometricSeries_convergent">GeometricSeries_convergent</a></span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">series</span>:Stream <span class="id" type="record"><a class="idref" href="http://coq.inria.fr/library/Coq.QArith.QArith_base.html#Q">Q</a></span>),<br/>
&nbsp;<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.CRGeometricSum.html#GeometricSeries">GeometricSeries</a></span> <span class="id" type="var">series</span> -&gt;<br/>
&nbsp;<span class="id" type="definition"><a class="idref" href="CoRN.reals.Series.html#convergent">convergent</a></span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">n</span> =&gt; <span class="id" type="definition"><a class="idref" href="CoRN.reals.Q_in_CReals.html#inj_Q">inj_Q</a></span> <span class="id" type="axiom"><a class="idref" href="CoRN.reals.CauchySeq.html#IR">IR</a></span> (<span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Str_nth">Str_nth</a></span> <span class="id" type="var">n</span> <span class="id" type="var">series</span>)).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="lemma"><a name="InfiniteGeometricSum_correct">InfiniteGeometricSum_correct</a></span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">series</span>:Stream <span class="id" type="record"><a class="idref" href="http://coq.inria.fr/library/Coq.QArith.QArith_base.html#Q">Q</a></span>) (<span class="id" type="var">x</span>:nat -&gt; <span class="id" type="axiom"><a class="idref" href="CoRN.reals.CauchySeq.html#IR">IR</a></span>),<br/>
&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">n</span>:nat, <span class="id" type="definition"><a class="idref" href="CoRN.reals.Q_in_CReals.html#inj_Q">inj_Q</a></span> <span class="id" type="axiom"><a class="idref" href="CoRN.reals.CauchySeq.html#IR">IR</a></span> (<span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.Lists.Streams.html#Str_nth">Str_nth</a></span> <span class="id" type="var">n</span> <span class="id" type="var">series</span>)%Q[=]<span class="id" type="var">x</span> <span class="id" type="var">n</span>) -&gt;<br/>
&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">Gs</span>:GeometricSeries <span class="id" type="var">series</span>) <span class="id" type="var">H</span>,<br/>
&nbsp;(<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.CRGeometricSum.html#InfiniteGeometricSum">InfiniteGeometricSum</a></span> <span class="id" type="var">Gs</span>==IRasCR (&sum;<sub>0</sub><sup>&infin;</sup> <span class="id" type="var">x</span> <span class="id" type="var">H</span>))%CR.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="lemma"><a name="InfiniteGeometricSum_correct'">InfiniteGeometricSum_correct'</a></span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">series</span>:Stream <span class="id" type="record"><a class="idref" href="http://coq.inria.fr/library/Coq.QArith.QArith_base.html#Q">Q</a></span>),<br/>
&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">Gs</span>:GeometricSeries <span class="id" type="var">series</span>),<br/>
&nbsp;(<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.CRGeometricSum.html#InfiniteGeometricSum">InfiniteGeometricSum</a></span> <span class="id" type="var">Gs</span> == <span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.CRIR.html#IRasCR">IRasCR</a></span> (&sum;<sub>0</sub><sup>&infin;</sup> <span class="id" type="var">_</span> (<span class="id" type="lemma"><a class="idref" href="CoRN.reals.fast.CRGeometricSum.html#GeometricSeries_convergent">GeometricSeries_convergent</a></span> <span class="id" type="var">Gs</span>)))%CR.<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="section"><a class="idref" href="CoRN.reals.fast.CRGeometricSum.html#GeometricSeries">GeometricSeries</a></span>.<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr">coqdoc</a>
</div>

</div>

</body>
</html>