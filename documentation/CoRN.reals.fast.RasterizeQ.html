<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
<link href="coqdoc.css" rel="stylesheet" type="text/css"/>
<title>CoRN.reals.fast.RasterizeQ</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<div class="code">

<br/>

<br/>

<br/>
</div>

<div class="doc">
<a name="lab728"></a><h2 class="section">Rasterization</h2>

Rasterization takes finite enumeration of points in <span class="inlinecode"><span class="id" type="var">Q2</span></span> and moves them
around a little so that they lie on a raster.  Thus rasterization produces
a raster object that when interpreted as a finite enumeration of <span class="inlinecode"><span class="id" type="var">Q2</span></span> is
close to the original enumeration of points.  How close depends on how
fine a raster is chosen.

<br/><br/>
There is a choice as to how to treat points that lie outside of the bound
of a chosen rectangle for rasterization.  In this implemenation I choose
to push all points inside the raster.  In typical applications a rectangle
is chosen that contains all the points, so that this doesn't matter.

<br/><br/>
<span class="inlinecode"><span class="id" type="var">Rasterize</span> <span class="id" type="var">Point</span></span> adds a single point <span class="inlinecode"><span class="id" type="var">p</span></span> into a raster. 
</div>
<div class="code">
<span class="id" type="keyword">Definition</span> <span class="id" type="definition"><a name="RasterizePoint">RasterizePoint</a></span> <span class="id" type="var">n</span> <span class="id" type="var">m</span> (<span class="id" type="var">bm</span>:raster <span class="id" type="var">n</span> <span class="id" type="var">m</span>) (<span class="id" type="var">t</span> <span class="id" type="var">l</span> <span class="id" type="var">b</span> <span class="id" type="var">r</span>:Q) (<span class="id" type="var">p</span>:Q*Q) : <span class="id" type="definition"><a class="idref" href="CoRN.raster.Raster.html#raster">raster</a></span> <span class="id" type="var">n</span> <span class="id" type="var">m</span> :=<br/>
<span class="id" type="keyword">let</span> <span class="id" type="var">i</span> := <span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.Arith.Min.html#min">min</a></span> (<span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.Init.Peano.html#pred">pred</a></span> <span class="id" type="var">n</span>) (<span class="id" type="definition"><a class="idref" href="CoRN.algebra.Basics.html#Z_to_nat">Z_to_nat</a></span> (<span class="id" type="lemma"><a class="idref" href="http://coq.inria.fr/library/Coq.ZArith.Zmax.html#Zle_max_l">Zle_max_l</a></span> 0 (<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.Interval.html#rasterize1">rasterize1</a></span> <span class="id" type="var">l</span> <span class="id" type="var">r</span> <span class="id" type="var">n</span> (<span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id" type="var">p</span>)))) <span class="id" type="keyword">in</span><br/>
<span class="id" type="keyword">let</span> <span class="id" type="var">j</span> := <span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.Arith.Min.html#min">min</a></span> (<span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.Init.Peano.html#pred">pred</a></span> <span class="id" type="var">m</span>) (<span class="id" type="definition"><a class="idref" href="CoRN.algebra.Basics.html#Z_to_nat">Z_to_nat</a></span> (<span class="id" type="lemma"><a class="idref" href="http://coq.inria.fr/library/Coq.ZArith.Zmax.html#Zle_max_l">Zle_max_l</a></span> 0 (<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.Interval.html#rasterize1">rasterize1</a></span> <span class="id" type="var">b</span> <span class="id" type="var">t</span> <span class="id" type="var">m</span> (<span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id" type="var">p</span>)))) <span class="id" type="keyword">in</span><br/>
<span class="id" type="var">setRaster</span> <span class="id" type="var">bm</span> <span class="id" type="constructor"><a class="idref" href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> (<span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.Init.Peano.html#pred">pred</a></span> <span class="id" type="var">m</span> - <span class="id" type="var">j</span>) <span class="id" type="var">i</span>.<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="lemma"><a name="RasterizePoint_carry">RasterizePoint_carry</a></span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> <span class="id" type="var">b</span> <span class="id" type="var">r</span> <span class="id" type="var">n</span> <span class="id" type="var">m</span> (<span class="id" type="var">bm</span>:raster <span class="id" type="var">n</span> <span class="id" type="var">m</span>) <span class="id" type="var">p</span> <span class="id" type="var">i</span> <span class="id" type="var">j</span>,<br/>
&nbsp;<span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.Bool.Bool.html#Is_true">Is_true</a></span> (<span class="id" type="definition"><a class="idref" href="CoRN.raster.Raster.html#RasterIndex">RasterIndex</a></span> <span class="id" type="var">bm</span> <span class="id" type="var">i</span> <span class="id" type="var">j</span>) -&gt; <span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.Bool.Bool.html#Is_true">Is_true</a></span> (<span class="id" type="definition"><a class="idref" href="CoRN.raster.Raster.html#RasterIndex">RasterIndex</a></span> (<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.RasterizeQ.html#RasterizePoint">RasterizePoint</a></span> <span class="id" type="var">bm</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> <span class="id" type="var">b</span> <span class="id" type="var">r</span> <span class="id" type="var">p</span>) <span class="id" type="var">i</span> <span class="id" type="var">j</span>).<br/>

<br/>
</div>

<div class="doc">
Rasterization is done by rasterizing each point, and composing
the resulting raster transfomers.  A fold_left is done for efficency.
(It is translated to a fold_right when we reason about it). 
</div>
<div class="code">
<span class="id" type="keyword">Definition</span> <span class="id" type="definition"><a name="RasterizeQ2">RasterizeQ2</a></span> (<span class="id" type="var">f</span>:FinEnum <span class="id" type="lemma"><a class="idref" href="CoRN.reals.fast.RasterQ.html#stableQ2">stableQ2</a></span>) <span class="id" type="var">n</span> <span class="id" type="var">m</span> (<span class="id" type="var">t</span> <span class="id" type="var">l</span> <span class="id" type="var">b</span> <span class="id" type="var">r</span>:Q) : <span class="id" type="definition"><a class="idref" href="CoRN.raster.Raster.html#raster">raster</a></span> <span class="id" type="var">n</span> <span class="id" type="var">m</span> :=<br/>
<span class="id" type="var">fold_left</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> =&gt; @<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.RasterizeQ.html#RasterizePoint">RasterizePoint</a></span> <span class="id" type="var">n</span> <span class="id" type="var">m</span> <span class="id" type="var">x</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> <span class="id" type="var">b</span> <span class="id" type="var">r</span> <span class="id" type="var">y</span>) <span class="id" type="var">f</span> (<span class="id" type="definition"><a class="idref" href="CoRN.raster.Raster.html#emptyRaster">emptyRaster</a></span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>).<br/>
<span class="id" type="keyword">Section</span> <span class="id" type="section"><a name="RasterizeCorrect">RasterizeCorrect</a></span>.<br/>

<br/>
<span class="id" type="keyword">Let</span> <span class="id" type="definition"><a name="C">C</a></span> := <span class="id" type="keyword">fun</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span> (<span class="id" type="var">n</span>:nat) (<span class="id" type="var">i</span>:Z) =&gt; <span class="id" type="var">l</span> + (<span class="id" type="var">r</span> - <span class="id" type="var">l</span>) * (2 * <span class="id" type="var">i</span> + 1 # 1) / (2 * <span class="id" type="var">n</span> # 1).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="lemma"><a name="rasterization_error">rasterization_error</a></span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> (<span class="id" type="var">w</span>:Qpos) <span class="id" type="var">n</span> <span class="id" type="var">x</span>,<br/>
(<span class="id" type="var">l</span> &lt;= <span class="id" type="var">x</span> &lt;= <span class="id" type="var">l</span> + <span class="id" type="var">w</span>) -&gt;<br/>
<span class="id" type="var">ball</span> (<span class="id" type="var">m</span>:=Q_as_MetricSpace) ((1 #2*P_of_succ_nat <span class="id" type="var">n</span>) * <span class="id" type="var">w</span>) (<span class="id" type="var">C</span> <span class="id" type="var">l</span> (<span class="id" type="var">l</span> + <span class="id" type="var">w</span>) (<span class="id" type="constructor"><a class="idref" href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id" type="var">n</span>) (<span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.Arith.Min.html#min">min</a></span> <span class="id" type="var">n</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="definition"><a class="idref" href="CoRN.algebra.Basics.html#Z_to_nat">Z_to_nat</a></span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="lemma"><a class="idref" href="http://coq.inria.fr/library/Coq.ZArith.Zmax.html#Zle_max_l">Zle_max_l</a></span> 0 (<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.Interval.html#rasterize1">rasterize1</a></span> <span class="id" type="var">l</span> (<span class="id" type="var">l</span>+w) (<span class="id" type="constructor"><a class="idref" href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id" type="var">n</span>) <span class="id" type="var">x</span>))))) <span class="id" type="var">x</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="lemma"><a name="switch_line_interp">switch_line_interp</a></span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">b</span> <span class="id" type="var">m</span> <span class="id" type="var">j</span>, (<span class="id" type="var">j</span> &lt;= <span class="id" type="var">m</span>)%nat -&gt; <span class="id" type="var">C</span> <span class="id" type="var">t</span> <span class="id" type="var">b</span> (<span class="id" type="constructor"><a class="idref" href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id" type="var">m</span>) (<span class="id" type="var">m</span> - <span class="id" type="var">j</span>)%nat == <span class="id" type="var">C</span> <span class="id" type="var">b</span> <span class="id" type="var">t</span> (<span class="id" type="constructor"><a class="idref" href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id" type="var">m</span>) <span class="id" type="var">j</span>.<br/>

<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="variable"><a name="RasterizeCorrect.b">b</a></span> <span class="id" type="variable"><a name="RasterizeCorrect.l">l</a></span>:Q.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="variable"><a name="RasterizeCorrect.w">w</a></span> <span class="id" type="variable"><a name="RasterizeCorrect.h">h</a></span>:Qpos.<br/>

<br/>
<span class="id" type="keyword">Let</span> <span class="id" type="definition"><a name="r">r</a></span>:=l+w.<br/>
<span class="id" type="keyword">Let</span> <span class="id" type="definition"><a name="t">t</a></span>:=b+h.<br/>

<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="variable"><a name="RasterizeCorrect.f">f</a></span>:FinEnum <span class="id" type="lemma"><a class="idref" href="CoRN.reals.fast.RasterQ.html#stableQ2">stableQ2</a></span>.<br/>

<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="variable"><a name="RasterizeCorrect.n">n</a></span> <span class="id" type="variable"><a name="RasterizeCorrect.m">m</a></span> : <b>N</b>.<br/>

<br/>
<span class="id" type="keyword">Let</span> <span class="id" type="definition"><a name="errX">errX</a></span> : Q<SUP>+</SUP> := ((1#2*P_of_succ_nat <span class="id" type="var">n</span>)*w)%Qpos.<br/>
<span class="id" type="keyword">Let</span> <span class="id" type="definition"><a name="errY">errY</a></span> : Q<SUP>+</SUP> := ((1#2*P_of_succ_nat <span class="id" type="var">m</span>)*h)%Qpos.<br/>
<span class="id" type="keyword">Let</span> <span class="id" type="definition"><a name="err">err</a></span> : Q<SUP>+</SUP> := <span class="id" type="definition"><a class="idref" href="CoRN.model.totalorder.QposMinMax.html#Qpos_max">Qpos_max</a></span> <span class="id" type="var">errX</span> <span class="id" type="var">errY</span>.<br/>

<br/>
<span class="id" type="keyword">Hypothesis</span> <span class="id" type="variable"><a name="RasterizeCorrect.Hf">Hf</a></span>:forall <span class="id" type="var">x</span> <span class="id" type="var">y</span>, <span class="id" type="definition"><a class="idref" href="CoRN.metric2.FinEnum.html#InFinEnumC">InFinEnumC</a></span> ((<span class="id" type="var">x</span>,y):ProductMS <span class="id" type="var">_</span> <span class="id" type="var">_</span>) <span class="id" type="var">f</span> -&gt; <br/>
&nbsp;(<span class="id" type="var">l</span>&lt;= <span class="id" type="var">x</span> &lt;= <span class="id" type="var">r</span>) /\ (<span class="id" type="var">b</span> &lt;= <span class="id" type="var">y</span> &lt;= <span class="id" type="var">t</span>).<br/>

<br/>
</div>

<div class="doc">
The Rasterization is close to the original enumeration. 
</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <span class="id" type="lemma"><a name="RasterizeQ2_correct1">RasterizeQ2_correct1</a></span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>,<br/>
&nbsp;<span class="id" type="definition"><a class="idref" href="CoRN.metric2.FinEnum.html#InFinEnumC">InFinEnumC</a></span> ((<span class="id" type="var">x</span>,y):ProductMS <span class="id" type="var">_</span> <span class="id" type="var">_</span>) <span class="id" type="var">f</span> -&gt; <br/>
&nbsp;<span class="id" type="definition"><a class="idref" href="CoRN.logic.Classic.html#existsC">existsC</a></span> (<span class="id" type="definition"><a class="idref" href="CoRN.metric2.ProductMetric.html#ProductMS">ProductMS</a></span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>) <br/>
&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">p</span> =&gt; <span class="id" type="definition"><a class="idref" href="CoRN.metric2.FinEnum.html#InFinEnumC">InFinEnumC</a></span> <span class="id" type="var">p</span> (<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.RasterQ.html#InterpRaster">InterpRaster</a></span> (<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.RasterizeQ.html#RasterizeQ2">RasterizeQ2</a></span> <span class="id" type="var">f</span> (<span class="id" type="constructor"><a class="idref" href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id" type="var">n</span>) (<span class="id" type="constructor"><a class="idref" href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id" type="var">m</span>) <span class="id" type="var">t</span> <span class="id" type="var">l</span> <span class="id" type="var">b</span> <span class="id" type="var">r</span>) (<span class="id" type="var">l</span>,t) (<span class="id" type="var">r</span>,b))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id" type="projection"><a class="idref" href="CoRN.metric2.Metric.html#ball">ball</a></span> <span class="id" type="var">err</span> <span class="id" type="var">p</span> (<span class="id" type="var">x</span>,y)).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="lemma"><a name="RasterizeQ2_correct2">RasterizeQ2_correct2</a></span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>,<br/>
&nbsp;<span class="id" type="definition"><a class="idref" href="CoRN.metric2.FinEnum.html#InFinEnumC">InFinEnumC</a></span> ((<span class="id" type="var">x</span>,y):ProductMS <span class="id" type="var">_</span> <span class="id" type="var">_</span>) (<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.RasterQ.html#InterpRaster">InterpRaster</a></span> (<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.RasterizeQ.html#RasterizeQ2">RasterizeQ2</a></span> <span class="id" type="var">f</span> (<span class="id" type="constructor"><a class="idref" href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id" type="var">n</span>) (<span class="id" type="constructor"><a class="idref" href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id" type="var">m</span>) <span class="id" type="var">t</span> <span class="id" type="var">l</span> <span class="id" type="var">b</span> <span class="id" type="var">r</span>) (<span class="id" type="var">l</span>,t) (<span class="id" type="var">r</span>,b))<br/>
&nbsp;-&gt; (<span class="id" type="definition"><a class="idref" href="CoRN.logic.Classic.html#existsC">existsC</a></span> (<span class="id" type="definition"><a class="idref" href="CoRN.metric2.ProductMetric.html#ProductMS">ProductMS</a></span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>) <br/>
&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">p</span> =&gt; <span class="id" type="definition"><a class="idref" href="CoRN.metric2.FinEnum.html#InFinEnumC">InFinEnumC</a></span> <span class="id" type="var">p</span> <span class="id" type="var">f</span>/\ <span class="id" type="projection"><a class="idref" href="CoRN.metric2.Metric.html#ball">ball</a></span> <span class="id" type="var">err</span> <span class="id" type="var">p</span> (<span class="id" type="var">x</span>,y))).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="lemma"><a name="RasterizeQ2_correct">RasterizeQ2_correct</a></span> : <br/>
&nbsp;<span class="id" type="projection"><a class="idref" href="CoRN.metric2.Metric.html#ball">ball</a></span> <span class="id" type="var">err</span><br/>
&nbsp;&nbsp;(<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.RasterQ.html#InterpRaster">InterpRaster</a></span> (<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.RasterizeQ.html#RasterizeQ2">RasterizeQ2</a></span> <span class="id" type="var">f</span> (<span class="id" type="constructor"><a class="idref" href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id" type="var">n</span>) (<span class="id" type="constructor"><a class="idref" href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id" type="var">m</span>) <span class="id" type="var">t</span> <span class="id" type="var">l</span> <span class="id" type="var">b</span> <span class="id" type="var">r</span>) (<span class="id" type="var">l</span>,t) (<span class="id" type="var">r</span>,b))<br/>
&nbsp;&nbsp;<span class="id" type="var">f</span>.<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="section"><a class="idref" href="CoRN.reals.fast.RasterizeQ.html#RasterizeCorrect">RasterizeCorrect</a></span>.<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr">coqdoc</a>
</div>

</div>

</body>
</html>