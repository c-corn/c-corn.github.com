<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
<link href="coqdoc.css" rel="stylesheet" type="text/css"/>
<title>CoRN.reals.fast.Integration</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<div class="code">

<br/>

<br/>

<br/>

<br/>

<br/>
</div>

<div class="doc">
<a name="lab721"></a><h1 class="section">Effective Integration</h1>

<a name="lab722"></a><h2 class="section">stepSample</h2>

The first step in defining integration is to define the unit function on
<span class="inlinecode">[0,1]</span> as a <span class="inlinecode"><span class="id" type="var">Bounded</span> <span class="id" type="var">Function</span></span>.  This is defined to be the limit of
step functions approximating the unit function.

<br/><br/>
For efficenty reasons we want this approximation to be as good as we can muster because the number of steps this approximation returns will be
the number of samples that we will take of the function we want to
integrate.  Furthermore, we want the tree structure defining the step
function to be as balanced as possible.

<br/><br/>
First we create a step function with n steps that appoximates the
identity function, <span class="inlinecode"><span class="id" type="var">stepSample</span></span>. 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="lemma"><a name="oddGluePoint">oddGluePoint</a></span> (<span class="id" type="var">p</span>:positive) : 0 &lt; <span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.NArith.BinPos.html#Psucc">Psucc</a></span> <span class="id" type="var">p</span> # <span class="id" type="constructor"><a class="idref" href="http://coq.inria.fr/library/Coq.NArith.BinPos.html#xI">xI</a></span> <span class="id" type="var">p</span> /\ <span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.NArith.BinPos.html#Psucc">Psucc</a></span> <span class="id" type="var">p</span> # <span class="id" type="constructor"><a class="idref" href="http://coq.inria.fr/library/Coq.NArith.BinPos.html#xI">xI</a></span> <span class="id" type="var">p</span> &lt; 1.<br/>

<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="definition"><a name="stepSample">stepSample</a></span> : <span class="id" type="inductive"><a class="idref" href="http://coq.inria.fr/library/Coq.NArith.BinPos.html#positive">positive</a></span> -&gt; <span class="id" type="var">StepQ</span> := <span class="id" type="definition"><a class="idref" href="CoRN.algebra.Basics.html#positive_rect2">positive_rect2</a></span> <br/>
&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">StepQ</span>)<br/>
&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">p</span> <span class="id" type="var">rec1</span> <span class="id" type="var">rec2</span> =&gt; <span class="id" type="definition"><a class="idref" href="CoRN.metric2.StepFunctionSetoid.html#glue">glue</a></span> (<span class="id" type="constructor"><a class="idref" href="CoRN.model.structures.OpenUnit.html#Build_OpenUnit">Build_OpenUnit</a></span> (<span class="id" type="lemma"><a class="idref" href="CoRN.reals.fast.Integration.html#oddGluePoint">oddGluePoint</a></span> <span class="id" type="var">p</span>)) (<span class="id" type="definition"><a class="idref" href="CoRN.metric2.StepFunctionSetoid.html#constStepF">constStepF</a></span> (<span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.NArith.BinPos.html#Psucc">Psucc</a></span> <span class="id" type="var">p</span>#xI <span class="id" type="var">p</span>:QS) * <span class="id" type="var">rec1</span>) ((<span class="id" type="definition"><a class="idref" href="CoRN.metric2.StepFunctionSetoid.html#constStepF">constStepF</a></span> (1#(xI <span class="id" type="var">p</span>):QS))*(constStepF (<span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.NArith.BinPos.html#Psucc">Psucc</a></span> <span class="id" type="var">p</span>:QS) + <span class="id" type="definition"><a class="idref" href="CoRN.metric2.StepFunctionSetoid.html#constStepF">constStepF</a></span> (<span class="id" type="var">p</span>:QS)*rec2)))<br/>
&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">p</span> <span class="id" type="var">rec</span> =&gt; <span class="id" type="definition"><a class="idref" href="CoRN.metric2.StepFunctionSetoid.html#glue">glue</a></span> (<span class="id" type="notation"><a class="idref" href="CoRN.model.structures.OpenUnit.html#"'ou'.x"">ou</a></span> (1#2)) (<span class="id" type="definition"><a class="idref" href="CoRN.metric2.StepFunctionSetoid.html#constStepF">constStepF</a></span> (1#2:QS) * <span class="id" type="var">rec</span>) (<span class="id" type="definition"><a class="idref" href="CoRN.metric2.StepFunctionSetoid.html#constStepF">constStepF</a></span> (1#2:QS) * (<span class="id" type="definition"><a class="idref" href="CoRN.metric2.StepFunctionSetoid.html#constStepF">constStepF</a></span> (1:QS) + <span class="id" type="var">rec</span>)))<br/>
&nbsp;(<span class="id" type="definition"><a class="idref" href="CoRN.metric2.StepFunctionSetoid.html#constStepF">constStepF</a></span> (1#2:QS)).<br/>

<br/>
</div>

<div class="doc">
We want to prove that <span class="inlinecode"><span class="id" type="var">stepSample</span> <span class="id" type="var">n</span></span> is within (1/(2*n)) of the
identity function, but the identity function doesn't exist yet.
Instead we define the <span class="inlinecode"><span class="id" type="var">SupDistanceToLinear</span></span> which computes what would
the distance to a linear function on <span class="inlinecode">[0,1]</span>.  This distance function
is transitive in the sense that if a step function x is within e1 of
a linear function, and a step function y is within e2 of the same
linear function, then x and y are really within (e1+e2) of each other
(in Linf).
</div>
<div class="code">
<span class="id" type="keyword">Section</span> <span class="id" type="section"><a name="id01">id01</a></span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="lemma"><a name="SupDistanceToLinearBase_pos">SupDistanceToLinearBase_pos</a></span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">l</span> <span class="id" type="var">r</span>:Q) (<span class="id" type="var">H</span>:l&lt;r) (<span class="id" type="var">x</span>:Q), 0 &lt; <span class="id" type="definition"><a class="idref" href="CoRN.model.totalorder.QMinMax.html#Qmax">Qmax</a></span> (<span class="id" type="var">x</span>-l) (<span class="id" type="var">r</span>-x).<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="definition"><a name="SupDistanceToLinear">SupDistanceToLinear</a></span> := <span class="id" type="definition"><a class="idref" href="CoRN.metric2.StepFunctionSetoid.html#StepFfold">StepFfold</a></span> <br/>
&nbsp;(<span class="id" type="keyword">fun</span> (<span class="id" type="var">x</span>:QS) (<span class="id" type="var">l</span> <span class="id" type="var">r</span>:Q) (<span class="id" type="var">H</span>:l &lt; <span class="id" type="var">r</span>) =&gt; <span class="id" type="definition"><a class="idref" href="CoRN.model.structures.Qpossec.html#mkQpos">mkQpos</a></span> (<span class="id" type="lemma"><a class="idref" href="CoRN.reals.fast.Integration.html#SupDistanceToLinearBase_pos">SupDistanceToLinearBase_pos</a></span> <span class="id" type="var">H</span> <span class="id" type="var">x</span>)) <br/>
&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">b</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span> <span class="id" type="var">H</span> =&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="definition"><a class="idref" href="CoRN.model.totalorder.QposMinMax.html#Qpos_max">Qpos_max</a></span> (<span class="id" type="var">f</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="lemma"><a class="idref" href="CoRN.model.structures.OpenUnit.html#affineCombo_gt">affineCombo_gt</a></span> (<span class="id" type="definition"><a class="idref" href="CoRN.model.structures.OpenUnit.html#OpenUnitDual">OpenUnitDual</a></span> <span class="id" type="var">b</span>) <span class="id" type="var">H</span>)) (<span class="id" type="var">g</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="lemma"><a class="idref" href="CoRN.model.structures.OpenUnit.html#affineCombo_lt">affineCombo_lt</a></span> (<span class="id" type="definition"><a class="idref" href="CoRN.model.structures.OpenUnit.html#OpenUnitDual">OpenUnitDual</a></span> <span class="id" type="var">b</span>) <span class="id" type="var">H</span>)))).<br/>

<br/>
</div>

<div class="doc">
Various properties of <span class="inlinecode"><span class="id" type="var">SupDistanceToLinear</span></span> 
</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <span class="id" type="lemma"><a name="SupDistanceToLinear_glue">SupDistanceToLinear_glue</a></span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">o</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> (<span class="id" type="var">H</span>:a &lt; <span class="id" type="var">b</span>), <br/>
&nbsp;(<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.Integration.html#SupDistanceToLinear">SupDistanceToLinear</a></span> (<span class="id" type="definition"><a class="idref" href="CoRN.metric2.StepFunctionSetoid.html#glue">glue</a></span> <span class="id" type="var">o</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>) <span class="id" type="var">H</span> ==<br/>
&nbsp;<span class="id" type="definition"><a class="idref" href="CoRN.model.totalorder.QMinMax.html#Qmax">Qmax</a></span> (<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.Integration.html#SupDistanceToLinear">SupDistanceToLinear</a></span> <span class="id" type="var">l</span> (<span class="id" type="lemma"><a class="idref" href="CoRN.model.structures.OpenUnit.html#affineCombo_gt">affineCombo_gt</a></span> (<span class="id" type="definition"><a class="idref" href="CoRN.model.structures.OpenUnit.html#OpenUnitDual">OpenUnitDual</a></span> <span class="id" type="var">o</span>) <span class="id" type="var">H</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.Integration.html#SupDistanceToLinear">SupDistanceToLinear</a></span> <span class="id" type="var">r</span> (<span class="id" type="lemma"><a class="idref" href="CoRN.model.structures.OpenUnit.html#affineCombo_lt">affineCombo_lt</a></span> (<span class="id" type="definition"><a class="idref" href="CoRN.model.structures.OpenUnit.html#OpenUnitDual">OpenUnitDual</a></span> <span class="id" type="var">o</span>) <span class="id" type="var">H</span>)))%Q.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="lemma"><a name="SupDistanceToLinear_wd1">SupDistanceToLinear_wd1</a></span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">l1</span> <span class="id" type="var">r1</span> (<span class="id" type="var">H1</span>:l1 &lt; <span class="id" type="var">r1</span>) <span class="id" type="var">l2</span> <span class="id" type="var">r2</span> (<span class="id" type="var">H2</span>:l2 &lt; <span class="id" type="var">r2</span>),<br/>
&nbsp;(<span class="id" type="var">l1</span> == <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">r1</span> == <span class="id" type="var">r2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.Integration.html#SupDistanceToLinear">SupDistanceToLinear</a></span> <span class="id" type="var">x</span> <span class="id" type="var">H1</span> == <span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.Integration.html#SupDistanceToLinear">SupDistanceToLinear</a></span> <span class="id" type="var">x</span> <span class="id" type="var">H2</span>)%Q.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="lemma"><a name="Qmax_affineCombo">Qmax_affineCombo</a></span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">o</span>, <span class="id" type="var">a</span> &lt; <span class="id" type="var">b</span> -&gt; (<span class="id" type="definition"><a class="idref" href="CoRN.model.totalorder.QMinMax.html#Qmax">Qmax</a></span> (<span class="id" type="definition"><a class="idref" href="CoRN.model.totalorder.QMinMax.html#Qmax">Qmax</a></span> (<span class="id" type="var">x</span> - <span class="id" type="var">a</span>) (<span class="id" type="definition"><a class="idref" href="CoRN.model.structures.OpenUnit.html#affineCombo">affineCombo</a></span> <span class="id" type="var">o</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> - <span class="id" type="var">x</span>))<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" type="definition"><a class="idref" href="CoRN.model.totalorder.QMinMax.html#Qmax">Qmax</a></span> (<span class="id" type="var">x</span> - <span class="id" type="definition"><a class="idref" href="CoRN.model.structures.OpenUnit.html#affineCombo">affineCombo</a></span> <span class="id" type="var">o</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span>) (<span class="id" type="var">b</span> - <span class="id" type="var">x</span>)) == <span class="id" type="definition"><a class="idref" href="CoRN.model.totalorder.QMinMax.html#Qmax">Qmax</a></span> (<span class="id" type="var">x</span> - <span class="id" type="var">a</span>) (<span class="id" type="var">b</span> - <span class="id" type="var">x</span>))%Q.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="lemma"><a name="SupDistanceToLinear_split">SupDistanceToLinear_split</a></span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">o</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">c</span> (<span class="id" type="var">H0</span>:a &lt; <span class="id" type="var">c</span>) (<span class="id" type="var">H1</span>:c &lt; <span class="id" type="var">b</span>), <br/>
&nbsp;(<span class="id" type="var">c</span> == <span class="id" type="definition"><a class="idref" href="CoRN.model.structures.OpenUnit.html#affineCombo">affineCombo</a></span> (<span class="id" type="definition"><a class="idref" href="CoRN.model.structures.OpenUnit.html#OpenUnitDual">OpenUnitDual</a></span> <span class="id" type="var">o</span>) <span class="id" type="var">a</span> <span class="id" type="var">b</span>)%Q -&gt;<br/>
(<span class="id" type="definition"><a class="idref" href="CoRN.model.totalorder.QMinMax.html#Qmax">Qmax</a></span> (<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.Integration.html#SupDistanceToLinear">SupDistanceToLinear</a></span> (<span class="id" type="definition"><a class="idref" href="CoRN.metric2.StepFunctionSetoid.html#SplitL">SplitL</a></span> <span class="id" type="var">x</span> <span class="id" type="var">o</span>) <span class="id" type="var">H0</span>)<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.Integration.html#SupDistanceToLinear">SupDistanceToLinear</a></span> (<span class="id" type="definition"><a class="idref" href="CoRN.metric2.StepFunctionSetoid.html#SplitR">SplitR</a></span> <span class="id" type="var">x</span> <span class="id" type="var">o</span>) <span class="id" type="var">H1</span>) ==<br/>
&nbsp;<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.Integration.html#SupDistanceToLinear">SupDistanceToLinear</a></span> <span class="id" type="var">x</span> (<span class="id" type="lemma"><a class="idref" href="http://coq.inria.fr/library/Coq.QArith.QArith_base.html#Qlt_trans">Qlt_trans</a></span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H0</span> <span class="id" type="var">H1</span>))%Q.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="lemma"><a name="SupDistanceToLinear_wd2">SupDistanceToLinear_wd2</a></span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">x1</span> <span class="id" type="var">x2</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> (<span class="id" type="var">H</span>: <span class="id" type="var">a</span> &lt; <span class="id" type="var">b</span>), <span class="id" type="var">x1</span> == <span class="id" type="var">x2</span> -&gt;<br/>
(<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.Integration.html#SupDistanceToLinear">SupDistanceToLinear</a></span> <span class="id" type="var">x1</span> <span class="id" type="var">H</span> == <span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.Integration.html#SupDistanceToLinear">SupDistanceToLinear</a></span> <span class="id" type="var">x2</span> <span class="id" type="var">H</span>)%Q.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="lemma"><a name="SupDistanceToLinear_translate">SupDistanceToLinear_translate</a></span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">c</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> (<span class="id" type="var">H</span>:a &lt; <span class="id" type="var">b</span>) (<span class="id" type="var">H0</span>:a+c &lt; <span class="id" type="var">b</span> + <span class="id" type="var">c</span>),<br/>
&nbsp;&nbsp;(<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.Integration.html#SupDistanceToLinear">SupDistanceToLinear</a></span> <span class="id" type="var">x</span> <span class="id" type="var">H</span> == <span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.Integration.html#SupDistanceToLinear">SupDistanceToLinear</a></span> (<span class="id" type="definition"><a class="idref" href="CoRN.metric2.StepFunctionSetoid.html#constStepF">constStepF</a></span> (<span class="id" type="var">c</span>:QS) + <span class="id" type="var">x</span>) <span class="id" type="var">H0</span>)%Q.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="lemma"><a name="SupDistanceToLinear_scale">SupDistanceToLinear_scale</a></span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">c</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> (<span class="id" type="var">H</span>:a &lt; <span class="id" type="var">b</span>) (<span class="id" type="var">H0</span>:c*a &lt; <span class="id" type="var">c</span>*b),<br/>
&nbsp;&nbsp;(<span class="id" type="var">c</span>*SupDistanceToLinear <span class="id" type="var">x</span> <span class="id" type="var">H</span> == <span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.Integration.html#SupDistanceToLinear">SupDistanceToLinear</a></span> (<span class="id" type="definition"><a class="idref" href="CoRN.metric2.StepFunctionSetoid.html#constStepF">constStepF</a></span> (<span class="id" type="var">c</span>:QS) * <span class="id" type="var">x</span>) <span class="id" type="var">H0</span>)%Q.<br/>

<br/>
</div>

<div class="doc">
This is the "transitivity" of the <span class="inlinecode"><span class="id" type="var">SupDistanceToLinear</span></span> function. 
</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <span class="id" type="lemma"><a name="SupDistanceToLinear_trans">SupDistanceToLinear_trans</a></span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> (<span class="id" type="var">H</span>:a &lt; <span class="id" type="var">b</span>), <span class="id" type="definition"><a class="idref" href="CoRN.model.metric2.LinfMetricMonad.html#StepFSupBall">StepFSupBall</a></span> (<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.Integration.html#SupDistanceToLinear">SupDistanceToLinear</a></span> <span class="id" type="var">x</span> <span class="id" type="var">H</span> + <span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.Integration.html#SupDistanceToLinear">SupDistanceToLinear</a></span> <span class="id" type="var">y</span> <span class="id" type="var">H</span>) <span class="id" type="var">x</span> <span class="id" type="var">y</span>.<br/>

<br/>
</div>

<div class="doc">
The <span class="inlinecode"><span class="id" type="var">stepSample</span> <span class="id" type="var">p</span></span> is as close to the virtual identity function as
we excpet. 
</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <span class="id" type="lemma"><a name="stepSampleDistanceToId">stepSampleDistanceToId</a></span> : (<span class="id" type="keyword">forall</span> <span class="id" type="var">p</span>, <span class="id" type="definition"><a class="idref" href="CoRN.model.structures.Qpossec.html#QposEq">QposEq</a></span> (@<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.Integration.html#SupDistanceToLinear">SupDistanceToLinear</a></span> (<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.Integration.html#stepSample">stepSample</a></span> <span class="id" type="var">p</span>) 0 1 (@<span class="id" type="lemma"><a class="idref" href="CoRN.algebra.COrdFields.html#pos_one">pos_one</a></span> <span class="id" type="var">_</span>)) (1#(2*p))).<br/>

<br/>
</div>

<div class="doc">
Given a requested error of q, what is smallest n for <span class="inlinecode"><span class="id" type="var">stepFunction</span> <span class="id" type="var">n</span></span>
that will satifiy this error requirement. 
</div>
<div class="code">
<span class="id" type="keyword">Definition</span> <span class="id" type="definition"><a name="id01_raw_help">id01_raw_help</a></span> (<span class="id" type="var">q</span>:QposInf) : <span class="id" type="inductive"><a class="idref" href="http://coq.inria.fr/library/Coq.NArith.BinPos.html#positive">positive</a></span> := <br/>
<span class="id" type="keyword">match</span> <span class="id" type="var">q</span> <span class="id" type="keyword">with</span><br/>
|QposInfinity =&gt; 1%positive<br/>
|Qpos2Q<SUP>+</SUP><SUB>&infin;</SUB> <span class="id" type="var">q</span> =&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> (<span class="id" type="definition"><a class="idref" href="http://coq.inria.fr/library/Coq.QArith.Qround.html#Qceiling">Qceiling</a></span> ((1#2)/q)%Qpos) <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="constructor"><a class="idref" href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Zpos">Zpos</a></span> <span class="id" type="var">p</span> =&gt; <span class="id" type="var">p</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">_</span> =&gt; 1%positive<br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="lemma"><a name="id01_raw_help_le">id01_raw_help_le</a></span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">q</span>:Qpos),<br/>
&nbsp;((1#2*id01<span class="id" type="var">_raw_help</span> <span class="id" type="var">q</span>) &lt;= <span class="id" type="var">q</span>)%Q.<br/>

<br/>
</div>

<div class="doc">
Now define id01, the identity funciton on <span class="inlinecode">[0,1]</span> as a bounded function,
to be the limit of these <span class="inlinecode"><span class="id" type="var">stepSample</span></span> functions. 
</div>
<div class="code">
<span class="id" type="keyword">Definition</span> <span class="id" type="definition"><a name="id01_raw">id01_raw</a></span> (<span class="id" type="var">q</span>:QposInf) : <span class="id" type="var">StepQ</span> := <span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.Integration.html#stepSample">stepSample</a></span> (<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.Integration.html#id01_raw_help">id01_raw_help</a></span> <span class="id" type="var">q</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="lemma"><a name="id01_prf">id01_prf</a></span> : <span class="id" type="definition"><a class="idref" href="CoRN.metric2.Complete.html#is_RegularFunction">is_RegularFunction</a></span> (<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.Integration.html#id01_raw">id01_raw</a></span>:QposInf -&gt; <span class="id" type="definition"><a class="idref" href="CoRN.model.metric2.LinfMetric.html#LinfStepQ">LinfStepQ</a></span>).<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="definition"><a name="id01">id01</a></span> : <span class="id" type="definition"><a class="idref" href="CoRN.model.metric2.BoundedFunction.html#BoundedFunction">BoundedFunction</a></span> :=<br/>
<span class="id" type="var">Build_RegularFunction</span> <span class="id" type="lemma"><a class="idref" href="CoRN.reals.fast.Integration.html#id01_prf">id01_prf</a></span>.<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="section"><a class="idref" href="CoRN.reals.fast.Integration.html#id01">id01</a></span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab723"></a><h2 class="section">StepFunctions distribute over Completion</h2>

The distribution function maps StepF (Complete X) to Complete (StepF X).

</div>
<div class="code">
<span class="id" type="keyword">Definition</span> <span class="id" type="definition"><a name="distribComplete_raw">distribComplete_raw</a></span> (<span class="id" type="var">x</span>:StepF <span class="id" type="definition"><a class="idref" href="CoRN.model.metric2.CRmetric.html#CR">CR</a></span>) (<span class="id" type="var">e</span>:QposInf) : <span class="id" type="definition"><a class="idref" href="CoRN.model.metric2.LinfMetric.html#LinfStepQ">LinfStepQ</a></span> :=<br/>
<span class="id" type="var">StepFunction.Map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">z</span> =&gt; <span class="id" type="projection"><a class="idref" href="CoRN.metric2.Complete.html#approximate">approximate</a></span> <span class="id" type="var">z</span> <span class="id" type="var">e</span>) <span class="id" type="var">x</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="lemma"><a name="distribComplete_prf">distribComplete_prf</a></span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">x</span>:StepF <span class="id" type="definition"><a class="idref" href="CoRN.model.metric2.CRmetric.html#CR">CR</a></span>), <span class="id" type="definition"><a class="idref" href="CoRN.metric2.Complete.html#is_RegularFunction">is_RegularFunction</a></span> (<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.Integration.html#distribComplete_raw">distribComplete_raw</a></span> <span class="id" type="var">x</span>).<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="definition"><a name="distribComplete">distribComplete</a></span> (<span class="id" type="var">x</span>:StepF <span class="id" type="definition"><a class="idref" href="CoRN.model.metric2.CRmetric.html#CR">CR</a></span>) : <span class="id" type="definition"><a class="idref" href="CoRN.model.metric2.BoundedFunction.html#BoundedFunction">BoundedFunction</a></span> :=<br/>
<span class="id" type="var">Build_RegularFunction</span> (<span class="id" type="lemma"><a class="idref" href="CoRN.reals.fast.Integration.html#distribComplete_prf">distribComplete_prf</a></span> <span class="id" type="var">x</span>).<br/>

<br/>

<br/>
</div>

<div class="doc">
Given a uniformly continuous function f, and a step function g,
the composition f o g is a bounded function.  The map from g to f o g
is uniformly continuous with modulus <span class="inlinecode"><span class="id" type="var">mu</span> <span class="id" type="var">f</span></span>.

<br/><br/>
The same thing does not work for integrable functions becuase 
The map from g to f o g may not be uniformly continuous with modulus <span class="inlinecode"><span class="id" type="var">mu</span> <span class="id" type="var">f</span></span>.
However, I have not found a counter example where f o g is not uniformly
continuous.  In fact, when f is lipschitz, then the map from g to
f o g is Lipschitz.  However Lipschitz functions haven't been
formalzied yet. 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="definition"><a name="ComposeContinuous_raw">ComposeContinuous_raw</a></span> (<span class="id" type="var">f</span>:Q_as_MetricSpace--&gt;CR) (<span class="id" type="var">z</span>:LinfStepQ) : <span class="id" type="definition"><a class="idref" href="CoRN.model.metric2.BoundedFunction.html#BoundedFunction">BoundedFunction</a></span> := <span class="id" type="definition"><a class="idref" href="CoRN.model.metric2.LinfDistMonad.html#dist">dist</a></span> (<span class="id" type="lemma"><a class="idref" href="CoRN.model.metric2.LinfMetricMonad.html#uc_stdFun">uc_stdFun</a></span> <span class="id" type="var">f</span> ^@&gt; <span class="id" type="var">z</span>).<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="lemma"><a name="ComposeContinuous_prf">ComposeContinuous_prf</a></span> (<span class="id" type="var">f</span>:Q_as_MetricSpace --&gt; <span class="id" type="definition"><a class="idref" href="CoRN.model.metric2.CRmetric.html#CR">CR</a></span>) :<br/>
&nbsp;<span class="id" type="definition"><a class="idref" href="CoRN.metric2.UniformContinuity.html#is_UniformlyContinuousFunction">is_UniformlyContinuousFunction</a></span> (<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.Integration.html#ComposeContinuous_raw">ComposeContinuous_raw</a></span> <span class="id" type="var">f</span>) (<span class="id" type="projection"><a class="idref" href="CoRN.metric2.UniformContinuity.html#mu">mu</a></span> <span class="id" type="var">f</span>).<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="definition"><a name="ComposeContinuous">ComposeContinuous</a></span> (<span class="id" type="var">f</span>:Q_as_MetricSpace --&gt; <span class="id" type="definition"><a class="idref" href="CoRN.model.metric2.CRmetric.html#CR">CR</a></span>) : <span class="id" type="definition"><a class="idref" href="CoRN.model.metric2.LinfMetric.html#LinfStepQ">LinfStepQ</a></span> --&gt; <span class="id" type="definition"><a class="idref" href="CoRN.model.metric2.BoundedFunction.html#BoundedFunction">BoundedFunction</a></span> :=<br/>
&nbsp;<span class="id" type="constructor"><a class="idref" href="CoRN.metric2.UniformContinuity.html#Build_UniformlyContinuousFunction">Build_UniformlyContinuousFunction</a></span> (<span class="id" type="lemma"><a class="idref" href="CoRN.reals.fast.Integration.html#ComposeContinuous_prf">ComposeContinuous_prf</a></span> <span class="id" type="var">f</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab724"></a><h2 class="section">Riemann-Stieltjes Integral</h2>

A measure on the reals is represented by the inverse of it's cumlative
distribution function as a bounded function.  So at the moment we
can only integrate over bounded intervals.  This effectively the
Stieltjes integral <span class="inlinecode">&int; <span class="id" type="var">f</span> <span class="id" type="var">d</span>(<span class="id" type="var">g</span>^-1)</span>. 
</div>
<div class="code">
<span class="id" type="keyword">Definition</span> <span class="id" type="definition"><a name="IntegrateWithMeasure">IntegrateWithMeasure</a></span> (<span class="id" type="var">f</span>:Q_as_MetricSpace --&gt; <span class="id" type="definition"><a class="idref" href="CoRN.model.metric2.CRmetric.html#CR">CR</a></span>) : <span class="id" type="definition"><a class="idref" href="CoRN.model.metric2.BoundedFunction.html#BoundedFunction">BoundedFunction</a></span> --&gt; <span class="id" type="definition"><a class="idref" href="CoRN.model.metric2.CRmetric.html#CR">CR</a></span> :=<br/>
(<span class="id" type="definition"><a class="idref" href="CoRN.metric2.UniformContinuity.html#uc_compose">uc_compose</a></span> <span class="id" type="definition"><a class="idref" href="CoRN.model.metric2.IntegrableFunction.html#Integral">IntegrableFunction.Integral</a></span><br/>
(<span class="id" type="definition"><a class="idref" href="CoRN.metric2.UniformContinuity.html#uc_compose">uc_compose</a></span> <span class="id" type="definition"><a class="idref" href="CoRN.model.metric2.IntegrableFunction.html#BoundedAsIntegrable">BoundedAsIntegrable</a></span> (<span class="id" type="definition"><a class="idref" href="CoRN.metric2.Prelength.html#Cbind">Cbind</a></span> (<span class="id" type="definition"><a class="idref" href="CoRN.model.metric2.LinfMetric.html#LinfStepQPrelengthSpace">LinfStepQPrelengthSpace</a></span>) (<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.Integration.html#ComposeContinuous">ComposeContinuous</a></span> <span class="id" type="var">f</span>)))).<br/>

<br/>
</div>

<div class="doc">
The Riemann Integral uses the uniform measure on <span class="inlinecode">[0,1]</span>.  The
inverse of it's cumlative distribution function is <span class="inlinecode"><span class="id" type="var">id01</span></span>. 
</div>
<div class="code">
<span class="id" type="keyword">Definition</span> <span class="id" type="definition"><a name="Integrate01">Integrate01</a></span> <span class="id" type="var">f</span> := <span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.Integration.html#IntegrateWithMeasure">IntegrateWithMeasure</a></span> <span class="id" type="var">f</span> <span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.Integration.html#id01">id01</a></span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="definition"><a name="ContinuousSup01">ContinuousSup01</a></span> <span class="id" type="var">f</span> :=<br/>
(<span class="id" type="definition"><a class="idref" href="CoRN.metric2.UniformContinuity.html#uc_compose">uc_compose</a></span> <span class="id" type="definition"><a class="idref" href="CoRN.model.metric2.BoundedFunction.html#sup">sup</a></span> (<span class="id" type="definition"><a class="idref" href="CoRN.metric2.Prelength.html#Cbind">Cbind</a></span> (<span class="id" type="definition"><a class="idref" href="CoRN.model.metric2.LinfMetric.html#LinfStepQPrelengthSpace">LinfStepQPrelengthSpace</a></span>) (<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.Integration.html#ComposeContinuous">ComposeContinuous</a></span> <span class="id" type="var">f</span>))) <span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.Integration.html#id01">id01</a></span>.<br/>

<br/>
</div>

<div class="doc">
Our integral on <span class="inlinecode">[0,1]</span> is correct. 
</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <span class="id" type="lemma"><a name="Integrate01_correct">Integrate01_correct</a></span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">F</span> (<span class="id" type="var">H01</span>:Zero[&lt;=](1:IR)) (<span class="id" type="var">HF</span>:Continuous_I <span class="id" type="var">H01</span> <span class="id" type="var">F</span>)<br/>
&nbsp;(<span class="id" type="var">f</span>:Q_as_MetricSpace --&gt; <span class="id" type="definition"><a class="idref" href="CoRN.model.metric2.CRmetric.html#CR">CR</a></span>),<br/>
&nbsp;(<span class="id" type="keyword">forall</span> (<span class="id" type="var">o</span>:Q) <span class="id" type="var">H</span>, (0 &lt;= <span class="id" type="var">o</span> &lt;= 1) -&gt; (<span class="id" type="var">f</span> <span class="id" type="var">o</span> == <span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.CRIR.html#IRasCR">IRasCR</a></span> (<span class="id" type="var">F</span> (<span class="id" type="definition"><a class="idref" href="CoRN.reals.Q_in_CReals.html#inj_Q">inj_Q</a></span> <span class="id" type="axiom"><a class="idref" href="CoRN.reals.CauchySeq.html#IR">IR</a></span> <span class="id" type="var">o</span>) <span class="id" type="var">H</span>)))%CR -&gt; <br/>
&nbsp;(<span class="id" type="definition"><a class="idref" href="CoRN.reals.fast.CRIR.html#IRasCR">IRasCR</a></span> (&int;<sub>I</sub> 0 1 <span class="id" type="var">H01</span> <span class="id" type="var">F</span> <span class="id" type="var">HF</span>)==Integrate01 <span class="id" type="var">f</span>)%CR.<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr">coqdoc</a>
</div>

</div>

</body>
</html>